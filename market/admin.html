<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>x5market控制台</title>
  <link rel="icon" href="https://i.ibb.co/BHW14yr0/Newx5logo.png" />
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root { color-scheme: dark; --bg:#0b0b0b; --card:#121212; --line:#1f1f1f; --muted:#9aa0a6; --acc:#5eead4; }
    * { box-sizing: border-box; }
    body{ margin:0; background:var(--bg); color:#fff; font:14px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";}
    header{ position:sticky; top:0; z-index:10; background:rgba(0,0,0,.6); backdrop-filter:saturate(140%) blur(8px); border-bottom:1px solid var(--line); }
    .wrap{ max-width:1080px; margin:0 auto; padding:16px; }
    .row{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    input,select,button,textarea{ background:#171717; border:1px solid var(--line); color:#fff; padding:8px 10px; border-radius:10px; }
    input:focus,select:focus,textarea:focus{ outline:none; border-color:#3a3a3a; }
    button{ cursor:pointer; }
    button.primary{ background:#1d312e; border-color:#24443e; color:#8af5e2; }
    button.warn{ background:#2e1d1d; border-color:#443030; color:#fca5a5; }
    .tabs{ display:flex; gap:8px; margin-top:12px; }
    .tabs button{ padding:10px 14px; border-radius:999px; }
    .tabs button.active{ background:#222; border-color:#333; }
    .grid{ display:grid; gap:12px; grid-template-columns: repeat(1, minmax(0,1fr)); }
    @media (min-width: 900px){ .grid{ grid-template-columns: 2fr 1fr; } }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:14px; padding:16px; }
    .muted{ color:var(--muted); }
    table{ width:100%; border-collapse: collapse; }
    th,td{ padding:8px 6px; border-bottom:1px dashed var(--line); vertical-align: top; }
    .chip{ padding:2px 8px; border:1px solid var(--line); border-radius:999px; font-size:12px; color:var(--muted); }
    .right{ text-align:right; }
    .flex{ display:flex; gap:8px; align-items:center; }
    .hidden{ display:none; }
    .code{ background:#0f0f0f; border:1px solid var(--line); padding:8px; border-radius:8px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
  </style>
</head>
<body>
  <header>
    <div class="wrap row">
      <strong>x5market控制台</strong>
      <input id="base" placeholder="https://x5capital.onrender.com" size="36">
      <input id="token" placeholder="ADMIN_TOKEN" size="30">
      <button id="save" class="primary">保存</button>
      <span class="muted">（沒有 Token 就無法修改）</span>
    </div>
    <div class="wrap tabs">
      <button data-tab="items" class="active">商品</button>
      <button data-tab="orders">訂單</button>
      <button data-tab="tools">工具</button>
    </div>
  </header>

  <main class="wrap">
    <!-- Items -->
    <section id="tab-items">
      <div class="grid">
        <div class="card">
          <div class="row" style="justify-content:space-between">
            <div class="row">
              <input id="q" placeholder="搜尋 id / title" size="24">
              <select id="sort"><option value="sort">排序: sort_order</option><option value="recent">排序: 建立時間</option><option value="title">排序: 名稱</option></select>
              <button id="reloadItems">重新載入</button>
            </div>
            <div class="row">
              <button id="exportItems">匯出 JSON</button>
              <button id="importItems">匯入 JSON</button>
            </div>
          </div>
          <div style="overflow:auto; max-height:62vh; margin-top:6px;">
            <table id="itemsTable">
              <thead><tr>
                <th style="width:28%">商品</th><th>分類</th><th class="right">價格</th><th class="right">庫存</th><th class="right">排序</th><th>操作</th>
              </tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div class="card">
          <h3 id="formTitle">新增 / 編輯商品</h3>
          <div class="grid" style="grid-template-columns: 1fr;">
            <input id="f_id" placeholder="id（唯一，例：alpha-pass-1m）">
            <input id="f_sku"  placeholder="sku（可留空＝同 id）">
            <input id="f_title" placeholder="title">
            <textarea id="f_desc" placeholder="description" rows="3"></textarea>
            <input id="f_category" placeholder="category（例：membership/design）">
            <div class="row">
              <input id="f_price" type="number" step="0.01" placeholder="price">
              <input id="f_stock" type="number" step="1" placeholder="stock">
            </div>
            <input id="f_img" placeholder="image URL">
            <input id="f_sort" type="number" step="1" placeholder="sort_order（可空）">
            <div class="row">
              <button id="submitItem" class="primary">Upsert</button>
              <button id="resetForm">重置</button>
            </div>
            <div id="formMsg" class="muted"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Orders -->
    <section id="tab-orders" class="hidden">
      <div class="card row" style="justify-content:space-between">
        <div class="row">
          <select id="o_status">
            <option value="">全部</option>
            <option value="pending">pending</option>
            <option value="paid">paid</option>
            <option value="cancelled">cancelled</option>
            <option value="expired">expired</option>
          </select>
          <input id="o_q" placeholder="搜尋 id" size="24">
          <button id="reloadOrders">重新載入</button>
          <span id="ordersMsg" class="muted"></span>
        </div>
        <div class="row">
          <span id="ordersCount" class="chip">0 筆</span>
        </div>
      </div>
      <div class="card" style="overflow:auto; max-height:72vh;">
        <table id="ordersTable">
          <thead><tr>
            <th>訂單</th><th>資產/金額</th><th>狀態</th><th>建立</th><th>到期</th><th>動作</th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Tools -->
    <section id="tab-tools" class="hidden">
      <div class="card">
        <h3>清理逾期訂單</h3>
        <div class="row">
          <button id="sweep" class="warn">掃逾期（/orders/sweep-expired）</button>
          <span id="sweepMsg" class="muted"></span>
        </div>
      </div>
      <div class="card">
        <h3>快速貼上 JSON 匯入（同 /items/bulk-upsert）</h3>
        <p class="muted">格式：陣列，每筆可含 id、title、description、category、price、stock、img、sortOrder</p>
        <textarea id="jsonArea" rows="12" class="code" placeholder='[{"id":"alpha-pass-1m","title":"Alpha Pass(月)","price":19,"stock":50}]'></textarea>
        <div class="row" style="margin-top:8px;">
          <button id="bulkUpsert" class="primary">送出</button>
          <span id="bulkMsg" class="muted"></span>
        </div>
      </div>
    </section>
  </main>

  <script src="admin.js"></script>
</body>
</html>
