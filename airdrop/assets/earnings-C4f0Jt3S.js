import{u as M,r as i,j as e,R as O,c as R}from"./i18n-D25F8cls.js";const N="/airdrop/",L=s=>new URL(String(s).replace(/^\//,""),window.location.origin+(N.endsWith("/")?N:N+"/")).toString(),Y="x5_earnings_v1",z=(...s)=>s.filter(Boolean).join(" "),y=s=>String(s).padStart(2,"0"),T=(s,a,l)=>`${s}-${y(a)}-${y(l)}`,$=()=>{const s=new Date;return T(s.getFullYear(),s.getMonth()+1,s.getDate())},F=(s,a)=>new Date(s,a,0).getDate(),W=(s,a)=>new Date(s,a-1,1).getDay();function B(s,a){const[l,u]=i.useState(()=>{try{const c=localStorage.getItem(s);return c?JSON.parse(c):a}catch{return a}});return i.useEffect(()=>{try{localStorage.setItem(s,JSON.stringify(l))}catch{}},[s,l]),[l,u]}function J(){const{t:s,i18n:a}=M(),l=i.useMemo(()=>{const t=new Date(Date.UTC(2024,0,7)),m=new Intl.DateTimeFormat(a.language,{weekday:"short"});return[...Array(7)].map((h,g)=>m.format(new Date(t.getTime()+g*864e5)))},[a.language]),[u,c]=B(Y,[]),r=new Date,[x,o]=i.useState(r.getFullYear()),[d,w]=i.useState(r.getMonth()+1),[v,k]=i.useState($()),[S,f]=i.useState(!1),p=`${x}-${y(d)}`,D=i.useMemo(()=>u.filter(t=>t.date.startsWith(p)),[u,p]),j=i.useMemo(()=>{let t=0,m=0;for(const h of D){const g=Number(h.amount)||0;h.type==="income"?t+=g:m+=g}return{inc:t,exp:m,net:t-m}},[D]),n=[];for(let t=0;t<W(x,d);t++)n.push({blank:!0,key:`b${t}`});for(let t=1;t<=F(x,d);t++){const m=T(x,d,t),h=u.filter(b=>b.date===m),g=h.filter(b=>b.type==="income").reduce((b,_)=>b+Number(_.amount||0),0),I=h.filter(b=>b.type==="expense").reduce((b,_)=>b+Number(_.amount||0),0);n.push({date:m,d:t,inc:g,exp:I,key:`d${t}`})}for(;n.length%7!==0;)n.push({blank:!0,key:`t${n.length}`});function C(t){const m=`e_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;c(h=>[{id:m,...t},...h])}function E(t){c(m=>m.filter(h=>h.id!==t))}return e.jsxs("div",{className:"min-h-screen bg-neutral-950 text-neutral-100",children:[e.jsx("header",{className:"sticky top-0 z-30 backdrop-blur border-b border-white/10 bg-neutral-950/70",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-3 flex items-center gap-3",children:[e.jsxs("a",{href:`${N}index.html`,className:"flex items-center gap-2",children:[e.jsx("img",{src:L("assets/newx5logo.png"),alt:"logo",className:"h-7 w-7 rounded"}),e.jsx("span",{className:"hidden sm:block text-sm font-semibold",children:s("brand","X5 Airdrop")})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{const t=new Date(x,d-2,1);o(t.getFullYear()),w(t.getMonth()+1)},className:"px-2 py-1 rounded-lg bg-white/10 border border-white/10 hover:bg-white/20","aria-label":"prev month",children:"←"}),e.jsxs("div",{className:"px-3 py-1.5 rounded-lg border border-white/10 bg-white/5 text-sm",children:[x," / ",y(d)]}),e.jsx("button",{onClick:()=>{const t=new Date(x,d,1);o(t.getFullYear()),w(t.getMonth()+1)},className:"px-2 py-1 rounded-lg bg-white/10 border border-white/10 hover:bg-white/20","aria-label":"next month",children:"→"}),e.jsx(P,{})]})]})}),e.jsxs("main",{className:"mx-auto max-w-7xl px-4 py-6",children:[e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"px-3 py-1.5 rounded-xl bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-sm",children:[s("month_income","本月收入"),"：",j.inc]}),e.jsxs("div",{className:"px-3 py-1.5 rounded-xl bg-rose-500/20 text-rose-200 border border-rose-400/30 text-sm",children:[s("month_expense","本月支出"),"：",j.exp]}),e.jsxs("div",{className:"px-3 py-1.5 rounded-xl bg-white/10 text-white border border-white/20 text-sm",children:[s("month_net","本月淨額"),"：",j.net]}),e.jsx("a",{href:`${N}index.html`,className:"ml-auto px-3 py-1.5 rounded-xl text-sm bg-white/10 hover:bg-white/20 border border-white/10",children:s("back_to_hub","回到任務主頁")})]}),e.jsx("div",{className:"grid grid-cols-7 text-xs text-neutral-400 mb-1",children:l.map(t=>e.jsx("div",{className:"px-2 py-1",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:n.map(t=>t.blank?e.jsx("div",{},t.key):e.jsxs("button",{onClick:()=>{k(t.date),f(!0)},className:"text-left rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 px-2 py-2 min-h-[80px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"text-xs text-neutral-400",children:y(new Date(t.date).getDate())}),t.date===$()&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gradient-to-r from-indigo-500 via-violet-500 to-fuchsia-500 text-white",children:s("today","今天")})]}),e.jsxs("div",{className:"space-y-1",children:[t.inc>0&&e.jsxs("div",{className:"text-xs text-emerald-300",children:["＋",t.inc]}),t.exp>0&&e.jsxs("div",{className:"text-xs text-rose-300",children:["－",t.exp]})]})]},t.key))})]}),S&&e.jsx(K,{date:v,entries:u.filter(t=>t.date===v),onClose:()=>f(!1),onAdd:t=>C(t),onDelete:t=>E(t)})]})}function K({date:s,entries:a,onAdd:l,onDelete:u,onClose:c}){const{t:r}=M(),[x,o]=i.useState("income"),[d,w]=i.useState(""),[v,k]=i.useState(""),[S,f]=i.useState(""),p=a.reduce((n,C)=>{const E=Number(C.amount)||0;return C.type==="income"?n.inc+=E:n.exp+=E,n},{inc:0,exp:0});function D(n){n.preventDefault(),d&&(l({date:s,type:x,amount:Number(d),asset:v,note:S}),w(""),k(""),f(""))}const j=[{value:"income",label:r("income","收入")},{value:"expense",label:r("expense","支出")}];return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur flex items-center justify-end",onClick:n=>{n.target===n.currentTarget&&c()},children:e.jsxs("div",{className:"w-full max-w-[420px] h-full overflow-auto bg-neutral-900 border-l border-white/10",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:s}),e.jsx("button",{onClick:c,className:"text-neutral-400 hover:text-white text-xl",children:"✕"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("form",{onSubmit:D,className:"rounded-2xl border border-white/10 bg-white/5 p-3 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(A,{value:x,onChange:o,options:j}),e.jsx("input",{value:d,onChange:n=>w(n.target.value),type:"number",step:"any",placeholder:r("amount","金額"),className:"rounded-xl bg-white/5 border border-white/10 px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{value:v,onChange:n=>k(n.target.value),placeholder:r("asset","資產/幣別"),className:"rounded-xl bg-white/5 border border-white/10 px-3 py-2 text-sm"}),e.jsx("input",{value:S,onChange:n=>f(n.target.value),placeholder:r("note","備註"),className:"rounded-xl bg-white/5 border border-white/10 px-3 py-2 text-sm"})]}),e.jsx("button",{type:"submit",className:"w-full px-3 py-2 rounded-xl bg-white text-black text-sm",children:r("add_record","新增紀錄")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("div",{className:"px-3 py-1.5 rounded-xl bg-emerald-500/20 text-emerald-200 border border-emerald-400/30",children:[r("income","收入"),"：",p.inc]}),e.jsxs("div",{className:"px-3 py-1.5 rounded-xl bg-rose-500/20 text-rose-200 border border-rose-400/30",children:[r("expense","支出"),"：",p.exp]}),e.jsxs("div",{className:"px-3 py-1.5 rounded-xl bg-white/10 text-white border border-white/20",children:[r("month_net","本月淨額"),"：",p.inc-p.exp]})]}),e.jsx("div",{className:"rounded-2xl border border-white/10 overflow-hidden",children:a.length===0?e.jsx("div",{className:"p-4 text-sm text-neutral-400 text-center",children:r("no_entries","這天沒有紀錄")}):a.map(n=>e.jsxs("div",{className:"p-3 border-b border-white/10 last:border-0 flex items-center gap-3",children:[e.jsx("span",{className:"px-2 py-0.5 rounded text-[11px] border "+(n.type==="income"?"bg-emerald-500/20 text-emerald-200 border-emerald-400/30":"bg-rose-500/20 text-rose-200 border-rose-400/30"),children:n.type==="income"?r("income","收入"):r("expense","支出")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm",children:[n.amount," ",n.asset||""]}),n.note&&e.jsx("div",{className:"text-xs text-neutral-400 truncate",children:n.note})]}),e.jsx("button",{onClick:()=>u(n.id),className:"text-sm text-rose-300 hover:text-rose-200",children:r("del","刪除")})]},n.id))})]})]})})}function A({value:s,onChange:a,options:l}){const[u,c]=i.useState(!1),r=O.useRef(null);i.useEffect(()=>{const o=d=>{r.current&&!r.current.contains(d.target)&&c(!1)};return window.addEventListener("click",o),()=>window.removeEventListener("click",o)},[]);const x=l.find(o=>o.value===s)||l[0];return e.jsxs("div",{className:"relative",ref:r,children:[e.jsxs("button",{type:"button",onClick:()=>c(o=>!o),className:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 rounded-xl text-sm bg-white/5 hover:bg-white/10 border border-white/10",children:[e.jsx("span",{className:"truncate",children:x.label}),e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",className:u?"rotate-180":"",children:e.jsx("path",{fill:"currentColor",d:"M7 10l5 5 5-5z"})})]}),u&&e.jsx("div",{className:"absolute left-0 mt-2 min-w-full rounded-xl border border-white/10 bg-neutral-900 shadow-lg overflow-hidden z-50",children:l.map(o=>e.jsx("button",{type:"button",className:z("w-full text-left px-3 py-2 text-sm hover:bg-white/10",o.value===s&&"bg-white/5"),onClick:()=>{a(o.value),c(!1)},children:o.label},o.value))})]})}function P(){const{i18n:s}=M(),a=[{value:"en",label:"EN"},{value:"zh-TW",label:"繁中"},{value:"ja",label:"日本語"},{value:"ko",label:"한국어"}];return e.jsx(A,{value:s.language,onChange:l=>{s.changeLanguage(l),localStorage.setItem("lang",l)},options:a})}R.createRoot(document.getElementById("root")).render(e.jsx(J,{}));
